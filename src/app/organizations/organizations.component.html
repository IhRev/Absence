@if(!isProcessing){
<!-- Empty container  -->
<div
  class="empty-container"
  *ngIf="organizations && organizations.length === 0"
>
  <h2>You have no organizations yet. Add your first organization!</h2>
  <button class="first-org-btn" (click)="openForm()">
    <i class="fa-solid fa-plus"></i> Add
  </button>
</div>

<!-- Not empty container -->
<div class="container">
  <!-- Message box  -->
  <div
    *ngIf="message"
    class="msg-box"
    [ngClass]="{
      'success-msg': isSuccess && message,
      'error-msg': !isSuccess && message
    }"
  >
    <span class="msg">{{ message }}</span>
    <button (click)="message = null" class="close-btn">
      <i class="fa-solid fa-xmark"></i>
    </button>
  </div>

  <!-- Blocks -->
  <div class="organizations-container" *ngIf="organizations">
    <!-- Organizations list -->

    <!-- Organizations list content -->
    <ng-template #orgListBlockContent>
      <ul class="list-box">
        <li
          *ngFor="let organization of organizations"
          class="item"
          (click)="selectOrganization(organization)"
          [class.active-item]="selectedOrganization === organization"
        >
          {{ organization.name }}
        </li>
      </ul>
    </ng-template>

    <!-- Desktop organizations list -->
    <div class="list-block wide-screen" *ngIf="organizations.length > 0">
      <div class="header">
        <h1 class="label">Organizations</h1>
        <button class="add-btn" (click)="openForm()">
          <i class="fa-solid fa-plus"></i>
        </button>
      </div>
      <ng-container *ngTemplateOutlet="orgListBlockContent"></ng-container>
    </div>

    <!-- Mobile organizations list -->
    <app-wrappable-control [title]="'Organizations'" class="narrow-screen">
      <div class="header">
        <button class="add-btn" (click)="openForm()">
          <i class="fa-solid fa-plus"></i>
        </button>
      </div>
      <ng-container *ngTemplateOutlet="orgListBlockContent"></ng-container>
    </app-wrappable-control>

    @if(members){
    <hr class="wide-screen" />

    <!-- Organization details content -->
    <ng-template #orgDetailsContent>
      <div class="org-details" *ngIf="selectedOrganization?.isAdmin">
        <button class="invite-btn" (click)="openInviteForm()">
          Invite user
        </button>
        @if (selectedOrganization?.isOwner) {
        <button class="edit-btn" (click)="openForm(selectedOrganization!)">
          Edit
        </button>
        <button class="delete-btn" (click)="confirmationPasswordOpened = true">
          Delete
        </button>
        }
      </div>
      <div class="list-block">
        <div class="header">
          <h2 class="label">Members</h2>
        </div>
        <ul class="list-box">
          <li
            *ngFor="let member of members"
            class="item"
            (click)="selectMember(member)"
            [class.active-item]="selectedMember === member"
          >
            {{ member.fullName }}
            <span *ngIf="member.isOwner" class="owner">owner</span>
            <span *ngIf="!member.isOwner && member.isAdmin" class="owner"
              >admin</span
            >
          </li>
        </ul>
      </div>
    </ng-template>

    <!-- Desktop organization details -->
    <div class="organization-block wide-screen">
      <h1>{{ selectedOrganization!.name }}</h1>
      <ng-container *ngTemplateOutlet="orgDetailsContent"></ng-container>
    </div>

    <!-- Mobile organization details -->
    <app-wrappable-control
      class="narrow-screen"
      [title]="selectedOrganization!.name"
    >
      <ng-container *ngTemplateOutlet="orgDetailsContent"></ng-container>
    </app-wrappable-control>
    } @if (selectedMember && !selectedMember.isOwner &&
    selectedOrganization?.isAdmin) {
    <hr class="wide-screen" />

    <!-- Member details content -->
    <ng-template #memberContent>
      <div class="member-details" *ngIf="selectedOrganization?.isAdmin">
        <button class="access-btn" (click)="openConfirmation(changeAccess)">
          Change access
        </button>
        <button class="delete-btn" (click)="openConfirmation(deleteUser)">
          Delete user
        </button>
      </div>
    </ng-template>

    <!-- Desktop member details -->
    <div class="member wide-screen">
      <h1 class="label">{{ selectedMember.fullName }}</h1>
      <ng-container *ngTemplateOutlet="memberContent"></ng-container>
    </div>

    <!-- Mobile member details -->
    <app-wrappable-control
      class="narrow-screen"
      [title]="selectedMember.fullName"
    >
      <ng-container *ngTemplateOutlet="memberContent"></ng-container>
    </app-wrappable-control>
    }
  </div>
</div>
} @else{
<i class="fa-solid fa-spinner fa-spin load-icon"></i>
}

<app-organization-form
  (closeModal)="closeForm()"
  (submitCreate)="add($event)"
  (submitEdit)="edit($event)"
  [organization]="organization"
  [isVisible]="isFormOpened"
/>

<app-invite-form
  (closeModal)="closeInviteForm()"
  (submitModal)="sendInvitation($event)"
  [isVisible]="isInviteFormOpened"
/>

<app-password-confirmation
  [isVisible]="confirmationPasswordOpened"
  (closed)="confirmationPasswordOpened = false"
  (submitted)="passwordConfirmed($event)"
/>

<app-confirmation
  [isVisible]="confirmationOpened"
  (closed)="confirmationOpened = false"
  (submitted)="confirmationSubmitted()"
/>
